
# ffmpegMp4Mix - 動画と音声の簡単結合ツール

## 概要
動画ファイルと音声ファイルを簡単に結合し、各オーディオトラックにトラック名を設定するためのバッチファイルです。  
`ffmpeg` を使用して、最近の MPC-BE などのメディアプレイヤーで正しくトラック名が表示されるようにします。

## 対象読者
- Windows PCの基本的な操作（ファイルの解凍やエクスプローラー設定など）ができる方。
- エクスプローラーで **ファイル名拡張子を表示** 設定にしていることを前提としています。

## 動作環境
- Windows 10 または Windows 11（推奨）

## ダウンロードとインストール

### ダウンロード
1. Github のリリースから最新バージョンをダウンロードしてください。：  
   [GitHub Link](https://github.com/bee7813993/ffmpegMp4Mix/releases)
2. ffmpeg公式サイトから Windows用の `ffmpeg`  をダウンロードしてください：  
   [https://ffmpeg.org/download.html](https://ffmpeg.org/download.html)  
   - ダウンロードした `ffmpeg`  を展開して、 `ffmpeg.exe` ファイルを設置します。  

### インストール
1. ダウンロードした `ffmpegMp4Mix_XXXXXXXX.zip` を任意のフォルダに解凍します。
2  `ffmpeg.exe` ファイルを同じフォルダーにコピーします。
3. 以下のファイルが含まれていればOK：
   ```
   ffmpeg.exe
   mixtrack_ffmpeg.bat
   makesendto.bat
   ...
   ```
4. フォルダ内の `makesendto.bat` をダブルクリックして実行します。
   - これにより、右クリックメニューの「送る」に `mixtrack_ffmpeg` が追加されます。

## 結合手順

### 手順
1. **結合したいファイルを準備**  
   動画ファイルと音声ファイルを同じフォルダに置きます。  
   ファイル名の先頭に番号を付けると、並べ替えが簡単です。例：  
   ```
   01_video.mp4
   02_audio1.m4a
   03_audio2.m4a
   ```

2. **ファイルを選択**  
   動画ファイルと音声ファイルをすべて選択し、右クリック → **送る → mixtrack_ffmpeg** を選択。

3. **動画の音声を1トラック目に使用するかを入力**  
   コマンドプロンプトが表示され、0か1かを入力します。  
   0は動画の音声を1トラック目にしない  
   1は動画の音声を1トラック目にする  
   - **何も入力せず Enter** を押すと、「動画の音声を1トラック目にしない」となります。


4. **トラック名を入力**  
   コマンドプロンプトが表示され、トラック名を入力します。  
   - **何も入力せず Enter** を押すと、デフォルトのトラック名が使用されます。

5. **処理完了後の確認**  
   処理が完了すると、「動画ファイル名_mixed.mp4」が生成されます。

### 確認
- 以下の項目でトラック名が正しく表示されることを確認してください：
  - 再生中の左上のOSD表示
  - 右クリックメニューの「オーディオトラック選択」
  - コントロールバーの「音声言語ボタン」

## カスタマイズ

バッチファイルを編集することで、以下の動作をカスタマイズできます：

### 元の動画の音声を使用するか
- デフォルトでは、動画内の音声を完成動画の1トラック目にするか問い合わせがあります。
- USE_VIDEO_AUDIOに設定をしておくことで、問い合わせなく常に設定した内容となります。

  ```bat
  set USE_VIDEO_AUDIO=1
  ```
  - **`0`**: 動画の音声を1トラック目にしない  
  - **`1`**: 動画の音声を1トラック目にする  

### MPC-BE 1.5互換モード
- MPC-BE 1.5 でのトラック名の重複表示を防ぎます：
  ```bat
  set MPCBE15_COMPAT_MODE=1
  ```
  - **`0`**: MPC-BE 1.6以降および1.4以前で正しく表示  
  - **`1`**: MPC-BE 1.5でトラック名の重複を防ぐ  
  
  ※互換モードではMPC-BE 1.4およびゆかり2017年5月12日版(2024年時点での最新版)ではトラック名が表示されなくなります。


### トラック名のデフォルト値
- デフォルトのトラック名を変更できます：
  ```bat
  set TRACKNAME_1=オンボーカル
  set TRACKNAME_2=オフボーカル
  set TRACKNAME_LATER=トラック
  ```

## 注意点
- ファイル名に以下の文字が含まれている場合、エラーになる可能性があります：
  - `*`, `?`, `"`, `<`, `>` など。
- ファイル名に括弧 `()` やスペースが含まれていても動作するよう対応済み。

## あとがき
これまで `L-SMASH Muxer` などで結合していた方にもおすすめのツールです。  
GUIツールよりも効率的に作業を行えるよう設計されています。ぜひお試しください！
